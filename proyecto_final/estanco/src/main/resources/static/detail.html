<!DOCTYPE html>
<html>
<head>
	<title>Tienda</title>
	<meta name="Description" content="Tabacos">
	<meta charset="utf-8">
	<meta lang="es">

	<!--Link necesario para el css de bootstrap-->
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-giJF6kkoqNQ00vy+HMDP7azOuL0xtbfIcaT9wjKHr8RbDVddVHyTfAAsrekwKmP1" crossorigin="anonymous">


	<style type="text/css">
		
		.estancoColors{
			background-color: #8B0000;
		}
	</style>

</head>
<body>

	<header class="container-fluid estancoColors py-1">

		<div class="row">
	
			<div class="container col-8 mt-3">
				<h1 class="display-1 text-warning text-center mt-4">ESTANCO VIRTUAL</h1>
				<div class="row">
					<p class="lead text-warning text-center">Bienvenido a tu estanco de confianza desde casa</p>
				</div>
			</div>
		
			<div class="container col-4">
				<img src="https://union-estanqueros.com/wp-content/uploads/2017/07/logo_solo.png" width="200"
				height="200" class="mt-0">
			</div>
		</div>
	</header>



	<nav class="navbar navbar-expand-lg navbar-light bg-light">
	  <a class="navbar-brand" href="#">
	      <img src="https://www.estancosalamanca35.com/uploads/kvpWTKOX/Logo.png" width="30" height="30" class="d-inline-block align-top" alt=""> EstancoVIRTUAL
	  </a>

	  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
    	<span class="navbar-toggler-icon"></span>
  	 </button>

	  <div class="collapse navbar-collapse border border-2 justify-content-center" id="navbarNavAltMarkup">
	    <div class="navbar-nav">
	      <a class="nav-item nav-link" href="home.html">HOME</a>
	      <a class="nav-item nav-link active" href="detail.html">DETAIL</a>
	      <a class="nav-item nav-link" href="contact.html">CONTACT</a>
	    </div>
	  </div>
	</nav>


	<div id= "tabaco-structure" class="container-fluid">
		
		<div class="row py-2 estancoColors align-items-center">

			<!--Boton desplegable de bootstrap para poder elegir el tabaco que nos muestra-->

			<div class="col-2">
				<div class="dropdown">
				  <button class="btn btn-warning dropdown-toggle" type="button" id="dropdownMenuButton2" data-bs-toggle="dropdown" aria-expanded="false">
				    Elije el tabaco
				  </button>
				  <ul class="dropdown-menu dropdown-menu-light" aria-labelledby="dropdownMenuButton2">
				    <li><a class="dropdown-item active" href="#tabacoIndustrial">Tabaco Industrial</a></li>
				    <li><a class="dropdown-item" href="#tabacoLiar"> Tabaco de Liar</a></li>
				  </ul>
				</div>
			</div>

			<div class="col-8">
				<h1 class="display-3 text-warning text-center">Tabacos</h1>
			</div>
		</div>

		<div class="container py-5 col" >

			<div class="row " id="cart-article" style="visibility: hidden;">

				<div class="container-fluid d-flex flex-column">

					<div class="container-fluid text-center my-3">
						<p class="h5" id="marca-tabaco">VACIO</p>
					</div>
					<div class="container-fluid text-center my-3">
						<p class="h5" id="precio-tabaco">VACIO</p>
					</div>
					<div class="container-fluid d-flex flex-row text-center my-3">
						<div class="container-fluid">
							<button class="btn-dark" id="btn-less">-</button>
						</div>
						<div class="container-fluid">
							<p id="unidades">0</p>
						</div>
						<div class="container-fluid">
							<button class="btn-dark" id="btn-more">+</button>
						</div>

					</div>
					<div class="container-fluid text-center my-3">
						<button class="btn-dark" id="btn-add">ADD TO CART</button>
					</div>
					<div class="container-fluid text-center my-3">
						<button class="btn-dark" id="btn-close">CLOSE</button>
					</div>

				</div>

			</div>
				
				<!--Piensa en que la row es como un container flex box-->

			<div class="row" id="tabaco-grid" style="visibility: visible;">

				<!--Cada card tiene un width determinado de 20rem-->
				<!--Indicamos que el div padre ocupe las columnas necesarias que le exiga el hijo-->
				<!--Cuando se pase de 12: salto de linea-->

			</div>

		</div>

	</div>

	<footer class="container-fluid estancoColors py-5 mt-5">

		<div class="container-fluid rounded border border-2 border-warning col-6">
			<p class="lead text-warning text-center">Derechos reservados</p>
		</div>

	</footer>

	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/js/bootstrap.bundle.min.js" integrity="sha384-JEW9xMcG8R+pH31jmWH6WWP0WintQrMb4s7ZOdauHnUtxwoG2vI5DkLtS3qm9Ekf" crossorigin="anonymous"></script>

</body>

<script type="text/javascript">

	//inicializo el JSON que me van a devolver del back
	var industrialSearchModel={};
	var liarSearchModel={};

	//Nada mas entrar en la pagina hago los dos fetch y me guardo la info en las variables

	loadTabaco("tabacoIndustrial");
	loadTabaco("tabacoLiar");

	//Ya tengo mis tabacos guardados en dos JSON industrialSearchModel y liarSearchModel

	//De primeras formamos el grid de tabacos con el industrial

	formGrid("tabacoIndustrial");

	//Ahora añado un eventListener a window que se activa cada vez que cambia la # de la url

	window.addEventListener("hashchange",function(){

		let hashValue= window.location.hash;

		if(hashValue=="tabacoLiar"){
			formGrid("tabacoLiar");
		}

		if(hashValue=="tabacoIndustrial"){
			formGrid("tabacoIndustrial");
		}

	});

	
	function loadTabaco(type){

		let finalURL="http://localHost:8080/api/"+type;

		fetch(finalURL,{

			method:"GET",
			headers:{
				"Content-Type":"application/json",
				"Accept": "application/json"
			}

		})

		.then(function(response){
			if(response.ok){

				return response.json();
			}else{
				throw response;
			}
		})

		.then(function (r){

			if(type=="tabacoIndustrial"){

				industrialSearchModel=r;
			}else{
				liarSearchModel=r;
			}
		})

		.catch(error=>console.error(error))
	}

	function formGrid(type){
		const myGrid= document.getElementById("tabaco-grid");
		
		let html="";
		let listCajetas=null;
		let counter=null;

		if(type=="tabacoIndustrial"){
			listCajetas = industrialSearchModel.items;
			counter= industrialSearchModel.count;
		}else{
			listCajetas=liarSearchModel.items;
			counter=liarSearchModel.count;
		}
			

		//La unica variable que no es igual entre tabaco industrial y liar es cigarrillos vs gramos
		//Asi que eso lo guardo en una variable a parte

		for (let i=0; i<counter; i++){
			//creacion de las cards

			let cajeta= listCajetas[i];
			let aux=null;
			debugger

			if(type=="tabacoIndustrial"){
				aux=cajeta.cigarrillos;
			}else{
				aux=cajeta.gramos;
			}
				

			html+= '<div class="col">'+
			 '<div class="card m-auto my-5" style="width: 20rem">'+
			 `<img class="card-img-top" src="${cajeta.imagen}" height="400" alt="Card image cap">`+
			 '<div class="card-body">'+
			 `<h5 class="card-title">${cajeta.marca}</h5>`+
			 `<p class="card-text">${cajeta.descripcion}</p>`+
			 `<p class="card-text">Precio: ${cajeta.precio}</p>`+
			 `<p class="card-text">Cantidad: ${aux}</p>`+
			 `<button class="btn btn-primary button-card" id="btn${i}" type="button">Comprar</button>`+
			 '</div>'+
			 '</div>'+
			 '</div>';

		}

		myGrid.innerHTML="";
		myGrid.innerHTML=html;
		
		addEvents(type);

	}

	function addEvents(type){

		if(type=="tabacoIndustrial"){
			listCajetas = industrialSearchModel.items;
		}else{
			listCajetas=liarSearchModel.items;
		}
			

		//Nos devuelve un vector con todos los buttons de los cards
		var cards = document.getElementsByClassName("button-card");

		//Añadimos un click listener a cada button de cada card
		for(let i = 0; i<cards.length;i++){

			cards[i].addEventListener("click",function(e){

				//Lo primero distinguimos en que card han dado click
				var evento = e.currentTarget.id;
				debugger

				//Una vez sabemos que id tiene el boton nos guardamos la cajeta correspondiente
				let cajeta = listCajetas[i];
				debugger

				document.getElementById("tabaco-grid").style.visibility = "hidden";
				document.getElementById("cart-article").style.visibility = "visible";

				document.getElementById("marca-tabaco").innerHTML = cajeta.marca;
				document.getElementById("precio-tabaco").innerHTML = cajeta.precio;
			})
		}

	}




</script>
</html>